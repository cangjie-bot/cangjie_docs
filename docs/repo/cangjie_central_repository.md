# 仓颉中心仓

## 仓颉中心仓介绍

**仓颉中心仓 (Cangjie Central Repository)** 是仓颉官方的三方库托管平台，提供统一、稳定、高质量的仓颉三方库托管服务，为用户提供方便的三方库贡献和使用方式，从而促进仓颉生态的蓬勃发展。

## 中心仓三方库管理规范

仓颉中心仓以**制品**的形式管理三方库。关于制品，有如下重要概念：

- **制品包**：一个源码压缩包，是仓颉中心仓存储三方库的最小单元。制品包有以下三个关键属性：
    - 制品名：用于标注制品包的类别；
    - 制品版本：用于标注制品包的版本号；
    - 组织名（非必需）：用于标注制品包隶属的组织，制品包可以不隶属于任何组织而独立存在。
- **制品**：制品名和组织名相同的所有版本制品包的集合，制品内的所有制品包均拥有唯一的版本号。
- **组织**：组织名相同的所有制品的集合，组织内的所有制品均拥有唯一的制品名。

> **注意：**
>
> - 制品名和组织名由大小写字母、数字和下划线 (`_`) 组成，长度为 [3, 64]，并且必须以 0 个或任意个下划线加上 1 个大写或小写字母开头，例如 `cangjie_demo_1`, `__Cangjie_Demo_2`；
> - 制品版本号格式为 `主版本号.次版本号.修订版本号`，三个等级的版本号均为自然数，例如 `1.2.3`, `1234.5678.90`。

基于上述定义，仓颉中心仓遵循如下的三方库管理规范：

1. 仓颉中心仓内每个组织的组织名唯一，组织内每个制品的制品名唯一，制品内每个制品包的制品版本唯一；`(组织名，制品名，制品版本)` 的三元组可以唯一确定一个制品包；
2. 可以存在隶属于不同组织的同名制品，不同制品也可以存在版本号相同的制品包；
3. 不隶属于任何组织的制品也拥有唯一制品名，即仓颉中心仓内不会存在不隶属于任何组织的两个同名制品；同时，仓颉中心仓内可以存在两个同名制品，其中一个制品隶属于某一组织，另一个制品不隶属于任何组织。

仓颉中心仓的**制品包**是一个满足仓颉项目管理工具 `cjpm (Cangjie Project Manager)` 规格要求的源码压缩包，其代码结构为一个 **cjpm 模块 (cjpm module)**。请参阅[仓颉项目管理工具使用指南](添加链接)以了解更多关于 `cjpm` 的信息。

## 中心仓页面使用说明

[仓颉中心仓官网](添加链接)是官方提供的仓颉中心仓网页，提供账户操作、制品查询、组织管理等功能。

### 注册账号

（账号注册、登录）

### 查看个人信息

（个人信息查看、个人 token 创建及获取）

### 查看制品信息

（搜索制品、查看单一制品）

### 创建及查看组织

（创建组织、查看组织、搜索组织、搜索组织内制品）

## 中心仓客户端配置

仓颉项目管理工具 `cjpm` 集成了仓颉中心仓客户端功能，因此需要在本地安装仓颉 `SDK` 并进行中心仓相关配置。

### 安装仓颉工具链

请参阅[仓颉 `SDK` 安装指南](添加链接)安装并验证本地仓颉环境。

### 本地配置文件

`cjpm` 通过配置文件 `cangjie-repo.toml` 进行中心仓相关配置，其格式如下：

```toml
[repository.cache]
  path = "/path/to/repository/cache"    # 本地存放路径

[repository.home]
  registry = "central/repo/url"         # 中心仓 url
  token = "user-token"                  # 用户个人 token
```

其中，各配置字段含义如下：

- `repository.cache.path`: 配置本地缓存路径，用于存放从中心仓下载的制品包源码：
    - 配置的路径可以为绝对路径或相对路径，若为相对路径，则为相对当前 `cangjie-repo.toml` 的路径；
    - 若配置项为空，则 `Linux/macOS` 上最终生效的路径为 `$HOME/.cjpm`，`Windows` 上最终生效的路径为 `%USERPROFILE%\.cjpm`；
    - 假设最终生效的路径为 `CACHE_PATH`，则从中心仓下载的制品包源码及其他中心仓相关内容会存放在 `${CACHE_PATH}/repository` 目录下。
- `repository.home.registry`: 配置中心仓 url，用于与仓颉中心仓进行上传下载相关的通信。
- `repository.home.token`: 配置用户个人 token，用于在上传制品包时进行用户认证。

用户可在如下三个位置配置 `cangjie-repo.toml`，按优先级顺序排序，`cjpm` 会基于优先级依次检查，当检查到高优先级的 `cangjie-repo.toml` 时就使用该配置文件内的所有配置项，并忽略低优先级的配置：

1. 执行 `cjpm` 命令对应的本地 `cjpm` 模块内，与模块配置文件 `cjpm.toml` 同级的 `cangjie-repo.toml`；
2. 用户目录下 `.cjpm` 目录内的 `cangjie-repo.toml`，`Linux/macOS` 上为 `$HOME/.cjpm/cangjie-repo.toml`，`Windows` 上为 `%USERPROFILE%\.cjpm\cangjie-repo.toml`；
3. 仓颉 `SDK` 中 `tools/config` 目录下的 `cangjie-repo.toml`，仓颉 `SDK` 中默认存在该文件，其中所有配置为默认值。

配置完仓颉 `SDK` 和 `cangjie-repo.toml` 后，就可以使用 `cjpm` 集成的中心仓客户端能力，与仓颉中心仓进行制品交互。

## 中心仓客户端使用说明

仓颉项目管理工具 `cjpm` 集成了仓颉中心仓客户端功能，提供打包制品包、上传制品包到中心仓、依赖中心仓内制品包等功能。请参阅[仓颉项目管理工具使用指南](添加链接)以了解更多关于 `cjpm` 的信息。

### 使用中心仓内的源码包

#### 依赖中心仓源码包

中心仓内的源码制品包对应一个 `cjpm` 模块，因此可以被本地开发的 `cjpm` 模块以依赖项的形式导入。

`cjpm` 中心仓依赖项格式如下：

```toml
[dependencies]
  dep1 = "1.0.0"                # 依赖版本号为 1.0.0 的制品 dep1
  dep2 = { version = "2.0.0" }  # 依赖版本号为 2.0.0 的制品 dep2，该写法等价于 dep2 = "2.0.0"
  dep3 = "[1.0.0, 3.0.0)"       # 依赖版本号大于等于 1.0.0，小于 3.0.0 的任意版本的制品 dep3
  "org::dep4" = "4.0.0"         # 依赖版本号为 4.0.0，并且隶属于 org 组织的制品 dep4
```

#### 安装中心仓可执行程序

### 上传本地代码到中心仓

## 中心仓制品审核规则

## 联系我们